-- Update asma_husna author attribution and footer lines

BEGIN;

WITH asma_updates (id, author_name, footer_text) AS (
VALUES
  ('4d3df1a6-8f8d-4bb7-9e2c-1f705d429f11'::uuid, 'امام ابوحامد غزالی (رح)', 'نویسنده: امام ابوحامد غزالی (رح) ؛ گردآورنده: سیدعبدالله ابن سیدعبدالرحمن شیرزادی'),
  ('2c3f6f4f-4b8a-47fb-8ff0-c6e664bb8f9a'::uuid, 'امام ابوحامد غزالی (رح)', 'نویسنده: امام ابوحامد غزالی (رح) ؛ گردآورنده: سیدعبدالله ابن سیدعبدالرحمن شیرزادی'),
  ('f4db80da-5aa8-47a0-8b95-01334b7b01c2'::uuid, 'امام ابوحامد غزالی (رح)', 'نویسنده: امام ابوحامد غزالی (رح) ؛ گردآورنده: سیدعبدالله ابن سیدعبدالرحمن شیرزادی'),
  ('45ff8b3f-c1b2-4efe-b11c-3684a8f7e4d6'::uuid, 'امام فخرالدین رازی (رح)', 'نویسنده: امام فخرالدین رازی (رح) ؛ گردآورنده: سیدعبدالله ابن سیدعبدالرحمن شیرزادی'),
  ('2e126f10-ff95-4297-9d43-b328d32ca17e'::uuid, 'امام ابوحامد غزالی (رح)', 'لیکوال: امام ابوحامد غزالی (رح) ؛ راټولوونکی: سیدعبدالله ابن سیدعبدالرحمن شیرزادی'),
  ('17d21f9b-6bde-41f1-949f-2862f0dbf66d'::uuid, 'امام ابوحامد غزالی (رح)', 'لیکوال: امام ابوحامد غزالی (رح) ؛ راټولوونکی: سیدعبدالله ابن سیدعبدالرحمن شیرزادی'),
  ('56a5ec6a-5a87-4aa7-95f8-8fbfbc7ac142'::uuid, 'امام ابوحامد غزالی (رح)', 'لیکوال: امام ابوحامد غزالی (رح) ؛ راټولوونکی: سیدعبدالله ابن سیدعبدالرحمن شیرزادی'),
  ('6efeecfd-bbf2-47bd-90ea-8f4200d2f73a'::uuid, 'امام فخرالدین رازی (رح)', 'لیکوال: امام فخرالدین رازی (رح) ؛ راټولوونکی: سیدعبدالله ابن سیدعبدالرحمن شیرزادی')
)
UPDATE public.articles AS a
SET
  author_name = u.author_name,
  body = (
    regexp_replace(
      regexp_replace(
        a.body,
        E'[[:space:]]*<p><em>نویسنده:[^<]*</em></p>[[:space:]]*$',
        '',
        'g'
      ),
      E'[[:space:]]*<p><em>لیکوال:[^<]*</em></p>[[:space:]]*$',
      '',
      'g'
    ) || E'\n\n<p><em>' || u.footer_text || '</em></p>'
  ),
  updated_at = NOW()
FROM asma_updates AS u
WHERE a.id = u.id
  AND a.category = 'asma_husna';

COMMIT;
